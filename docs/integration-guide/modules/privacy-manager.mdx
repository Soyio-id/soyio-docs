import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import SequenceDiagram from '../../../src/components/SequenceDiagram';

# Gestor de privacidad (Privacy Manager)

Integra un gestor de privacidad directamente en tu aplicaci√≥n para permitir a los usuarios gestionar sus datos personales de manera sencilla y transparente.

El **Privacy Manager** es un m√≥dulo integral que te ayuda a cumplir con las regulaciones de protecci√≥n de datos proporcionando diferentes funcionalidades especializadas seg√∫n tus necesidades.

:::info[Informaci√≥n]
Por ahora, este servicio est√° disponible **s√≥lo para el SDK Web**.
:::

## Funcionalidades disponibles

El **Privacy Manager** incluye las siguientes funcionalidades que puedes habilitar seg√∫n tus necesidades:

### üîê Rights Enforcement (Ejercicio de Derechos)
Permite a los usuarios ejercer sus derechos de protecci√≥n de datos: acceso, rectificaci√≥n, oposici√≥n, supresi√≥n y portabilidad.

### ‚öôÔ∏è Consent Management (Gesti√≥n de Consentimientos)
Facilita la gesti√≥n y administraci√≥n de consentimientos otorgados por los usuarios.

---

## Integraci√≥n general

### Pre requisitos

1. Tener el [SDK](../quickstart.mdx) instalado en tu sitio o aplicaci√≥n.

### Configuraci√≥n b√°sica

<Tabs>
  <TabItem value="web" label="SDK Web" default>
    ```jsx
    import { PrivacyCenter } from "@soyio/soyio-widget";

    // Configuraci√≥n del componente
    const privacyCenterOptions = {
      companyId: "<company_id>",
      onEvent: (event) => console.log('Event:', event),
      enabledFeatures: ['DataSubjectRequests', 'ConsentManagement'],  // Optional
      onReady: () => console.log('Privacy Center is ready'),          // Optional
      appearance: {},                                                 // Optional
      isSandbox: false,                                               // Optional
      subjectId: "<subject_id>"                                       // Optional - entityId o identityId
    };

    // Montar el componente
    document.addEventListener("DOMContentLoaded", () => {
      const privacyCenter = new PrivacyCenter(privacyCenterOptions);
      privacyCenter.mount("#privacy-center-container");
    });
    ```

    ```html
    <!-- HTML -->
    <div id="privacy-center-container"></div>
    ```
  </TabItem>
</Tabs>

### Opciones de configuraci√≥n

| Opci√≥n | Tipo | Descripci√≥n |
| ------ | ---- | ----------- |
| `companyId` | String | Identificador de la empresa |
| `enabledFeatures` | Array | Features a habilitar |
| `onEvent` | Function | Callback que se ejecuta cuando el componente emite un evento |
| `onReady` | Function | Callback que se ejecuta cuando el componente est√° listo |
| `appearance` | Object | Configuraci√≥n de la apariencia del componente |
| `isSandbox` | Boolean | Indica si se ejecuta en modo sandbox (pruebas) |
| `subjectId` | String | Identificador del usuario (entityId o identityId) |

### Modos de uso

El **Privacy Manager** puede funcionar en dos modos diferentes seg√∫n el contexto de tu aplicaci√≥n:

#### üåê Modo P√∫blico

**Cu√°ndo usarlo:** Para usuarios no autenticados o cuando deseas proporcionar acceso universal a la gesti√≥n de privacidad.

**Caracter√≠sticas:**
- No requiere autenticaci√≥n previa del usuario.
- Permite que cualquier usuario gestione sus datos y consentimientos asociados a su identidad.
- Ideal para p√°ginas p√∫blicas de privacidad o centros de preferencias accesibles sin login.

**Configuraci√≥n:**

```jsx
// Modo p√∫blico
const privacyCenterOptions = {
  companyId: "<company_id>",
  enabledFeatures: ['DataSubjectRequests', 'ConsentManagement'],
  onEvent: (event) => console.log('Event:', event),
  onReady: () => console.log('Privacy Center is ready'), // Optional
  appearance: {},                                        // Optional
  isSandbox: false,                                      // Optional
};

const privacyCenter = new PrivacyCenter(privacyCenterOptions);
privacyCenter.mount("#privacy-center-container");
```

**Flujo del usuario:**
1. El usuario accede al Privacy Center
2. Se le solicita identificarse (email, tel√©fono, etc.)
3. Una vez validada su identidad, puede acceder a las funcionalidades habilitadas

---

#### üîí Modo Privado

**Cu√°ndo usarlo:** Para usuarios ya autenticados en tu aplicaci√≥n o cuando necesitas mayor control sobre la identificaci√≥n.

**Caracter√≠sticas:**
- Requiere que el usuario est√© previamente autenticado.
- Mayor seguridad mediante tokens de sesi√≥n.
- Ideal para dashboards de usuario o √°reas privadas de la aplicaci√≥n.

**Configuraci√≥n:**

**Paso 1:** [Obtener el token de sesi√≥n](../../api/resources/get-privacy-center-session-token) desde tu backend.

**Paso 2:** Configurar el Privacy Center with el token de sesi√≥n.

```jsx
// Modo privado
const privacyCenterOptions = {
  sessionToken: "<session_token>",
  enabledFeatures: ['DataSubjectRequests', 'ConsentManagement'],
  onEvent: (event) => console.log('Event:', event),
  onReady: () => console.log('Privacy Center is ready'), // Optional
  appearance: {},                                        // Optional
  isSandbox: false,                                      // Optional
};

const privacyCenter = new PrivacyCenter(privacyCenterOptions);
privacyCenter.mount("#privacy-center-container");
```

**Flujo del usuario:**
1. El usuario ya est√° autenticado en tu aplicaci√≥n.
2. Accede al Privacy Center con su sesi√≥n activa.
3. Inmediatamente puede acceder a las funcionalidades habilitadas.

---

## üîê Rights Enforcement (Ejercicio de Derechos)

**Identificador de la funcionalidad:** `DataSubjectRequests`

Esta funcionalidad permite a los usuarios ejercer sus derechos de protecci√≥n de datos de manera sencilla y transparente.

### Funcionalidades

- **Gestionar solicitudes de derechos**: Recibe y procesa las solicitudes de los usuarios para ejercer sus derechos de protecci√≥n de datos.
- **Integraci√≥n fluida**: Embebe el componente directamente en tu interfaz y personal√≠zalo con el *look and feel* de tu aplicaci√≥n.
- **Cumplimiento normativo**: Facilita el cumplimiento de las regulaciones de protecci√≥n de datos al proporcionar un canal claro para que los usuarios ejerzan sus derechos.
- **Trazabilidad**: Mant√©n un registro de todas las solicitudes realizadas por los usuarios para fines de auditor√≠a y cumplimiento.
- **Validaci√≥n de identidad**: Incluye un proceso de verificaci√≥n del usuario para asegurar la legitimidad de las solicitudes.

### Derechos que pueden ejercer los usuarios

1. **Acceso**: Permite al usuario saber qu√© datos personales tienen sobre ellos, si est√°n siendo utilizados, qui√©n los tiene y para qu√© los usa.
2. **Rectificaci√≥n**: Cuando la informaci√≥n del usuario es incorrecta o est√° desactualizada, pueden solicitar que se corrija o modifique. Se les solicitar√° documentaci√≥n que respalde los cambios.
3. **Oposici√≥n**: Permite al usuario solicitar que se deje de usar sus datos para ciertos fines, salvo que exista una obligaci√≥n legal que lo impida.
4. **Supresi√≥n**: Permite al usuario solicitar la eliminaci√≥n de sus datos cuando ya no sean necesarios o haya retirado su consentimiento, salvo que exista una obligaci√≥n legal para conservarlos.
5. **Portabilidad**: Permite al usuario solicitar la copia de sus datos personales en un formato estructurado, legible y portable.

<img src="/img/example_privacy_center.jpeg" alt="Privacy Center example" width="90%"/>

### Flujo de una solicitud de derechos

<SequenceDiagram
  actors={[
    { id: 'user', label: 'Usuario' },
    { id: 'privacy_center', label: 'Privacy Center' },
    { id: 'soyio_api', label: 'Soyio Api' },
    { id: 'organization', label: 'Organizaci√≥n' },
  ]}
  actions={[
    {
      from: 'user',
      to: 'privacy_center',
      label: 'Rellena formulario'
    },
    {
      from: 'privacy_center',
      to: 'soyio_api',
      label: 'Se crea un Data Subject Request'
    },
    {
      from: 'privacy_center',
      to: 'user',
      label: 'Solicita validaci√≥n de identidad'
    },
    {
      from: 'user',
      to: 'soyio_api',
      label: 'Completa validaci√≥n'
    },
    {
      from: 'soyio_api',
      to: 'organization',
      label: 'Notifica solicitud con identidad validada'
    },
    {
      from: 'organization',
      to: 'organization',
      label: 'Procesa solicitud'
    },
    {
      from: 'organization',
      to: 'soyio_api',
      label: 'Notifica estado de la solicitud'
    },
    {
      from: 'soyio_api',
      to: 'user',
      label: 'Notifica estado de la solicitud',
      isDashed: true,
    }
  ]}
/>

### Eventos espec√≠ficos

```typescript
{
    eventName: 'REQUEST_SUBMITTED',
    subjectId: string,
    kind: 'ACCESS' | 'RECTIFICATION' | 'OPPOSITION' | 'SUPPRESSION' | 'PORTABILITY',
    dataSubjectRequestId: string
}
```

En donde `kind` puede ser uno de los siguientes valores:

- `ACCESS`: Para ejercer el derecho de acceso.
- `RECTIFICATION`: Para ejercer el derecho de rectificaci√≥n.
- `OPPOSITION`: Para ejercer el derecho de oposici√≥n**.**
- `SUPPRESSION`: Para ejercer el derecho de supresi√≥n.
- `PORTABILITY`: Para ejercer el derecho de portabilidad.

Y `dataSubjectRequestId` es el identificador de la solicitud de derechos generado por Soyio, tambi√©n conocido como [`dataSubjectRequestId`](../../api/resources/index-data-subject-requests).

## ‚öôÔ∏è Consent Management (Gesti√≥n de Consentimientos)

**Identificador de la funcionalidad:** `ConsentManagement`

Esta funcionalidad permite a los usuarios gestionar y administrar los consentimientos otorgados por los usuarios a trav√©s del [m√≥dulo de consentimiento](./consent.mdx).

En este m√≥dulo, todos los [`consent_templates`](../../api/resources/schemas/consenttemplate) de la organizaci√≥n ser√°n visibles para el usuario, tanto los que ya otorgaron consentimiento como los que no.

### Funcionalidades

El m√≥dulo de **Consent Management** proporciona una experiencia integral para que los usuarios gestionen todos sus consentimientos de manera transparente y controlada.

#### üéØ Vista Centralizada
- **Todos los consentimientos en un lugar**: Presenta todos los [`consent_templates`](../../api/resources/schemas/consenttemplate) de tu organizaci√≥n con su estado actual (otorgado/no otorgado)
- **Organizaci√≥n inteligente**: Agrupa los consentimientos por categor√≠as para facilitar la navegaci√≥n

#### ‚úÖ Otorgar Consentimientos
- **Consentimientos pendientes**: Identifica autom√°ticamente qu√© consentimientos no han sido otorgados previamente.
- **Proceso guiado**: Proporciona informaci√≥n detallada antes de otorgar cada consentimiento.

#### üö´ Revocar Consentimientos
- **Revocaci√≥n inmediata**: Permite retirar consentimientos otorgados.
- **Impacto claro**: Explica qu√© funcionalidades se ver√°n afectadas al revocar cada consentimiento
- **Proceso reversible**: Facilita volver a otorgar consentimientos cuando sea necesario

<img src="/img/example_consent_management.webp" alt="Privacy Center example" width="90%"/>

---

## Configuraci√≥n avanzada

### Usando m√∫ltiples funcionalidades

Al utilizar s√≥lo 1 funcionalidad, entonces al inicializar el componente, se reedirige autom√°ticamente a la funcionalidad seleccionada**.
**En caso de habilitar m√°s de 1 funcionalidad, entonces al inicializar el componente, el usuario podr√° seleccionar la funcionalidad que desea utilizar.

```jsx
const privacyCenterOptions = {
  companyId: "<company_id>",
  enableFeatures: ['DataSubjectRequests', 'ConsentManagement'], // Ambas funcionalidades
  // ... resto de opciones
};
```

### Personalizaci√≥n

El componente puede ser personalizado mediante variables CSS:

```jsx
const privacyCenterOptions = {
  // ... otras opciones
  appearance: {
    variables: {
      fontFamily: 'system-ui, sans-serif',
      colorPrimary: '#f54c27',
      colorBackground: '#ffffff',
    },
    rules: {
      '.PrivacyCenter-container': {
        backgroundColor: 'var(--colorBackground)',
      }
    }
  }
};
```

:::tip[Pro Tip]
Para obtener m√°s informaci√≥n sobre las variables y reglas de personalizaci√≥n, consulta la [documentaci√≥n oficial del SDK web de Soyio](https://docs.soyio.co/docs/soyio-widget/customization).
:::

:::warning[Importante]
Aseg√∫rate de mantener los elementos de accesibilidad como el contraste adecuado y el tama√±o de fuente legible al personalizar el componente.
:::